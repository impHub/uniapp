(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/add"],{2924:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("4795"));function r(e){return e&&e.__esModule?e:{default:e}}function u(e,t){return d(e)||s(e,t)||a(e,t)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){if(e){if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,u=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done);i=!0)if(n.push(o.value),t&&n.length===t)break}catch(c){r=!0,u=c}finally{try{i||null==a["return"]||a["return"]()}finally{if(r)throw u}}return n}}function d(e){if(Array.isArray(e))return e}function l(e,t,n,i,r,u,o){try{var a=e[u](o),c=a.value}catch(s){return void n(s)}a.done?t(c):Promise.resolve(c).then(i,r)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var u=e.apply(t,n);function o(e){l(u,i,r,o,a,"next",e)}function a(e){l(u,i,r,o,a,"throw",e)}o(void 0)}))}}var h={onShow:function(){this.$u.auth()},data:function(){var e={name:"",sex:"",idCard:"",birth:"",address:"",nation:"",validStart:"",validEnd:"",cardOrg:"",cardFront:"",cardOpposite:"",avatar:"",mobile:"",residentRooms:[],deviceAddressIds:[]};return{steps:[{name:"基本信息"},{name:"上传图片"},{name:"选择房屋"},{name:"门禁授权"}],step:0,updateActionImg:this.$u.http.config.baseUrl+"/upload/img",updateActionOcr:this.$u.http.config.baseUrl+"/upload/ocr",updateHeader:{Authorization:this.$store.state.vuex_token},updateSizeType:["compressed"],datePicker:!1,houseShow:!1,relationShow:!1,quickSelect:{front:!0,unit:!1,own:!0},relationList:[{label:"子女",value:1},{label:"父母",value:2},{label:"亲属",value:3},{label:"朋友",value:4},{label:"其它",value:5}],propertyList:[{label:"业主",value:1},{label:"家庭成员",value:2},{label:"租户",value:3}],guardList:[],houseList:[],form:Object.assign({},e),defForm:Object.assign({},e),houseSelected:[],houseTemp:{}}},watch:{houseSelected:{handler:"changeHouse"},quickSelect:{deep:!0,immediate:!0,handler:"changeQuick"},guardList:{deep:!0,immediate:!0,handler:"changeGuard"}},computed:{disabledNext:function(){return!this.checkStep(this.step)}},mounted:function(){this.getData()},methods:{getData:function(){var e=this;return f(i.default.mark((function t(){var n,r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$u.api.getHouse();case 2:return e.houseList=t.sent,t.next=5,e.$u.api.getFront();case 5:return n=t.sent,t.next=8,e.$u.api.getUnit();case 8:r=t.sent,e.guardList=n.map((function(e){return Object.assign(e,{checked:!1,type:"front"})})).concat(r.map((function(e){return Object.assign(e,{checked:!1,type:"unit"})})));case 10:case"end":return t.stop()}}),t)})))()},checkStep:function(e){var t=this.form;return 0===e?this.$u.test.mobile(t.mobile):1===e?[t.name,t.sex,t.idCard,t.birth,t.nation,t.address,t.validStart,t.validEnd,t.cardOrg,t.avatar,t.cardFront,t.cardOpposite].reduce((function(e,t){return e&&t&&t.length>0}),!0):2===e?!!this.houseSelected.length:3===e&&(this.checkStep(0)&&this.checkStep(1)&&this.checkStep(2)&&!!t.deviceAddressIds.length)},beforeUpload:function(t){return e.showLoading({title:"正在上传……",mask:!0}),!0},uploadRemove:function(e){if(2===e){var t={},n=t.name,i=t.sex,r=t.nation,u=t.birth,o=t.address,a=t.idCard,c=t.imgUrl;Object.assign(this.form,{name:n,sex:i,nation:r,birth:u,address:o,idCard:a,cardOpposite:c})}else if(3===e){var s={},d=s.cardOrg,l=s.validStart,f=s.validEnd,h=s.imgUrl;Object.assign(this.form,{cardOrg:d,validStart:l,validEnd:f,cardFront:h})}},avatarSuccess:function(e){0===e.code&&(this.form.avatar=e.data)},oppositeSuccess:function(t){if(e.hideLoading(),0===t.code){var n=t.data,i=n.name,r=n.sex,u=n.nation,o=n.birth,a=n.address,c=n.idCard,s=n.imgUrl;i&&c?Object.assign(this.form,{name:i,sex:r,nation:u,birth:o,address:a,idCard:c,cardOpposite:s}):(this.$u.toast("信息识别错误，请上传正确的图片"),this.$refs.uploadOpposite.remove(0))}},frontSuccess:function(e){if(0===e.code){var t=e.data,n=t.cardOrg,i=t.validStart,r=t.validEnd,u=t.imgUrl;n&&i&&r?Object.assign(this.form,{cardOrg:n,validStart:i,validEnd:r,cardFront:u}):(this.$u.toast("信息识别错误，请上传正确的图片"),this.$refs.uploadFront.remove(0))}},changeHouse:function(){this.form.residentRooms=this.houseSelected.map((function(e){return{roomId:e.id,property:e.property,relationOwner:e.relation}})),this.changeQuick()},changeQuick:function(){var e=this,t=this.quickSelect;this.guardList.map((function(n){"front"===n.type?n.checked=t.front:"unit"===n.type&&(e.houseSelected.findIndex((function(e){return e.buildId===n.buildId&&e.unitId===n.unitId}))>-1?n.checked=t.unit||t.own:n.checked=t.unit)}))},changeGuard:function(){this.form.deviceAddressIds=this.guardList.filter((function(e){return!0===e.checked})).map((function(e){return e.id}))},selectHouse:function(e){var t=u(e,4),n=t[0],i=t[1],r=(t[2],t[3]);this.houseSelected.findIndex((function(e){return e.id===r.value}))<0?(this.houseTemp={id:r.value,name:r.label,buildId:n.value,buildName:n.label,unitId:i.value,unitName:i.label},this.relationShow=!0):this.$u.toast("该房屋已经添加")},selectRelation:function(e){this.houseTemp.property=e[0].value,this.houseTemp.relation=e[1].value,this.houseSelected.push(this.houseTemp),this.houseTemp={}},removeHouse:function(t){var n=this;e.showModal({title:"提示",content:"您确定要删除此项吗？",success:function(e){e.confirm&&n.houseSelected.splice(t,1)}})},showRelation:function(){document.activeElement.blur(),this.relationShow=!0},next:function(){this.step<this.steps.length-1&&this.step++},prev:function(){this.step>0&&this.step--},submit:function(){var t=this;e.showModal({title:"提示",content:"确认提交？",success:function(n){if(n.confirm){e.showLoading({title:"正在提交……",mask:!0});var i=Object.assign({},t.form);i.sex="男"===i.sex?1:2,t.$u.api.addUser(i).then((function(n){e.showModal({title:"提示",content:"提交成功，是否继续添加？",success:function(e){e.confirm?(t.step=0,t.form=Object.assign({},t.defForm)):t.$u.route({url:"/pages/index/index",type:"switchTab"})}})}))}}})},getLabel:function(e,t){var n=e.find((function(e){return e.value===t}))||{};return n.label}}};t.default=h}).call(this,n("543d")["default"])},"559c":function(e,t,n){},6185:function(e,t,n){"use strict";n.r(t);var i=n("d223"),r=n("9b80");for(var u in r)"default"!==u&&function(e){n.d(t,e,(function(){return r[e]}))}(u);n("eebd");var o,a=n("f0c5"),c=Object(a["a"])(r["default"],i["b"],i["c"],!1,null,"f616f8d2",null,!1,i["a"],o);t["default"]=c.exports},"653c":function(e,t,n){"use strict";(function(e){n("6ac9");i(n("66fd"));var t=i(n("6185"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"9b80":function(e,t,n){"use strict";n.r(t);var i=n("2924"),r=n.n(i);for(var u in i)"default"!==u&&function(e){n.d(t,e,(function(){return i[e]}))}(u);t["default"]=r.a},d223:function(e,t,n){"use strict";var i={uSteps:function(){return n.e("uview-ui/components/u-steps/u-steps").then(n.bind(null,"5ace"))},uCellGroup:function(){return n.e("uview-ui/components/u-cell-group/u-cell-group").then(n.bind(null,"d584"))},uCellItem:function(){return n.e("uview-ui/components/u-cell-item/u-cell-item").then(n.bind(null,"f6f5"))},uInput:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-input/u-input")]).then(n.bind(null,"3270"))},uFormItem:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-form-item/u-form-item")]).then(n.bind(null,"0e48"))},uUpload:function(){return n.e("uview-ui/components/u-upload/u-upload").then(n.bind(null,"8eaa"))},uGrid:function(){return n.e("uview-ui/components/u-grid/u-grid").then(n.bind(null,"5445"))},uGridItem:function(){return n.e("uview-ui/components/u-grid-item/u-grid-item").then(n.bind(null,"00ef"))},uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"ae25"))},uTag:function(){return n.e("uview-ui/components/u-tag/u-tag").then(n.bind(null,"407a"))},uCheckbox:function(){return n.e("uview-ui/components/u-checkbox/u-checkbox").then(n.bind(null,"6cf8"))},uButton:function(){return n.e("uview-ui/components/u-button/u-button").then(n.bind(null,"8d7f"))},uSelect:function(){return n.e("uview-ui/components/u-select/u-select").then(n.bind(null,"8793"))}},r=function(){var e=this,t=e.$createElement,n=(e._self._c,[e.form.validStart,e.form.validEnd].join(" - ")),i=e.__map(e.houseSelected,(function(t,n){var i=e.__get_orig(t),r=e.getLabel(e.propertyList,t.property),u=e.getLabel(e.relationList,t.relation);return{$orig:i,m0:r,m1:u}}));e._isMounted||(e.e0=function(t){e.houseShow=!0},e.e1=function(e,t){var n=arguments[arguments.length-1].currentTarget.dataset,i=n.eventParams||n["event-params"];t=i.item;t.checked=!t.checked}),e.$mp.data=Object.assign({},{$root:{g0:n,l0:i}})},u=[];n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return i}))},eebd:function(e,t,n){"use strict";var i=n("559c"),r=n.n(i);r.a}},[["653c","common/runtime","common/vendor"]]]);